# MQTT Broker Configuration

# Network Settings
listener 1883
protocol mqtt

listener 9001
protocol websockets

# Security Settings
allow_anonymous false
password_file /mosquitto/config/passwd
acl_file /mosquitto/config/acl

# TLS/SSL Configuration
cafile /mosquitto/certs/ca.crt
certfile /mosquitto/certs/server.crt
keyfile /mosquitto/certs/server.key
tls_version tlsv1.2

# Performance Tuning
max_queued_messages 1000
max_inflight_messages 20
max_connections 1000

# Persistence
persistence true
persistence_location /mosquitto/data/
autosave_interval 1800

# Logging
log_dest file /mosquitto/log/mosquitto.log
log_type all
connection_messages true
log_timestamp true

# Bridge Configuration for Cloud Backup
connection cloud_bridge
address cloud.example.com:8883
bridge_protocol_version mqttv311
bridge_insecure false
bridge_cafile /mosquitto/certs/cloud_ca.crt
bridge_certfile /mosquitto/certs/bridge.crt
bridge_keyfile /mosquitto/certs/bridge.key
try_private true

topic # both 2
start_type automatic
bridge_attempt_unsubscribe false
notifications true
notification_topic $SYS/broker/connection
cleansession true